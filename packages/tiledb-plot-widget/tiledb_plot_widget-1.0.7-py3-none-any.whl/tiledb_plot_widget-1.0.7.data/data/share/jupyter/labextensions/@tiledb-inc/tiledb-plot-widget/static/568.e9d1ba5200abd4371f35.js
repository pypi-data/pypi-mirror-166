"use strict";(self.webpackChunk_tiledb_inc_tiledb_plot_widget=self.webpackChunk_tiledb_inc_tiledb_plot_widget||[]).push([[568],{501:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,i)=>Math.max(e,Math.min(i,t))},5268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{let i;return(...s)=>new Promise((l=>{i&&clearTimeout(i),i=setTimeout((()=>l(e(...s))),t)}))}},1568:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=i(7708);n(i(8657),t);const r=o(i(1367)),u=i(8657),d={id:"@tiledb-inc/tiledb-plot-widget:plugin",requires:[a.IJupyterWidgetRegistry],autoStart:!0,activate:(e,t)=>{t.registerWidget({name:u.MODULE_NAME,version:u.MODULE_VERSION,exports:r})}};t.default=d},5879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.poll=void 0,t.poll=function(e,t=2e3,i=100){const s=Number(new Date)+t,l=function(t,n){const o=e();o?t(o):Number(new Date)<s?setTimeout(l,i,t,n):n(new Error("timed out for "+e+": "))};return new Promise(l)}},8657:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const s=i(4147);t.MODULE_VERSION=s.version,t.MODULE_NAME=s.name},1367:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return l(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DagVisualizeView=t.DagVisualizeModel=void 0;const a=i(7708),r=n(i(1686)),u=o(i(5268)),d=o(i(4658)),c=i(8657),p=i(5879),m=o(i(501));class b extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:b.model_name,_model_module:b.model_module,_model_module_version:b.model_module_version,_view_name:b.view_name,_view_module:b.view_module,_view_module_version:b.view_module_version,value:""})}}t.DagVisualizeModel=b,b.serializers=Object.assign({},a.DOMWidgetModel.serializers),b.model_name="DagVisualizeModel",b.model_module=c.MODULE_NAME,b.model_module_version=c.MODULE_VERSION,b.view_name="DagVisualizeView",b.view_module=c.MODULE_NAME,b.view_module_version=c.MODULE_VERSION;class h extends a.DOMWidgetView{render(){this.el.classList.add("tiledb-widget"),this.createSVG(),this.value_changed();const e=u.default(this.value_changed.bind(this),1500);this.model.on("change:value",e,this)}value_changed(){this.data=JSON.parse(this.model.get("value")),this.createDag()}calculateBounds(e){if(void 0===this.bounds){const t=Object.values(e).map((e=>e[0])),i=Object.values(e).map((e=>e[1])),s=30,l=60,n=Math.max(...t),o=Math.max(...i);this.bounds=[n+s,o+l]}return this.bounds}createSVG(){this.wrapper=r.select(this.el).append("svg").append("g"),this.svg=r.select(this.el).select("svg"),this.createControls(),this.createTooltip()}zoom(e,t){const i=this.svg,s=r.zoom().translateExtent([[0,0],[e,t]]).on("zoom",(e=>{this.wrapper.attr("transform",e.transform)}));function l(){var e;null===(e=r.event)||void 0===e||e.preventDefault();const t="zoom_in"===this.id?.2:-.2;i.transition().duration(300).call(s.scaleBy,1+t)}function n(){i.transition().duration(300).call(s.transform,r.zoomIdentity)}i.call(s).on("wheel.zoom",null),setTimeout((()=>{r.select(this.el).selectAll(".zoomControl").on("click",l),r.select(this.el).selectAll(".resetControl").on("click",n)}),0),this.initialized=!0}createTooltip(){this.tooltip=r.select(this.el).append("div").attr("class","tooltip").style("opacity",0)}getRootNodes(e,t){return e.filter((e=>t.every((([,t])=>e!==t))))}getNodeSize(e){return 15*e*.8}getHeightScale(e,t){const i=.7*t,s=.3*t,l=m.default(s,i,e);return[l,l/e]}async createDag(){const{nodes:e,edges:t,node_details:i,positions:s}=this.data,[l,n]=this.calculateBounds(s),[o,a]=this.getHeightScale(n,l),u=r.select(this.el).select("svg"),c=this.getNodeSize(a),b=l+c,h=m.default(225,b,b),g=(h-b)/2,_=e.length,v=h>5e3;u.attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${h} ${o}`),v&&u.attr("class","tiledb-plot--bolder"),g&&this.svg.select("g").attr("transform",`translate(${g})`),this.initialized||await p.poll((()=>this.el.offsetWidth>0),300);const y=_<30?"node--small":"";this.positions=this.positions||s,this.initialized||this.zoom(l,o);const j=t.map((([e,t])=>({source:e,target:t}))),w=Object.entries(i).map((([e,t],i)=>{const s=this.positions[e],[l,o]=s,r=l+c/2,u=(n-o)*a;return{index:i,name:t.name,status:t.status,id:e,fx:r,fy:u,x:r,y:u}})),x=new Worker(d.default);x.postMessage({nodes:w,links:j}),x.onmessage=e=>{if("end"!==e.data.type)return;const{nodes:t,links:i}=e.data;this.wrapper.selectAll("path").data(i).join((e=>{e.append("path").attr("d",(e=>`M${e.source.x},${e.source.y} C ${e.source.x},${(e.source.y+e.target.y)/2} ${e.target.x},${(e.source.y+e.target.y)/2} ${e.target.x},${e.target.y}`)).attr("class",(e=>`path-${f(e.target.status)}`))}),(e=>e.attr("class",(e=>`path-${f(e.target.status)}`)))),this.wrapper.selectAll("circle").data(t).join((e=>{e.append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",c).attr("class",(e=>`${f(e.status)} ${y}`)).on("mouseover",((e,t)=>{const i=t.name||t.id;this.tooltip.transition().duration(200).style("opacity",.9),this.tooltip.html(`<p class="tiledb-plot-tooltip">${i}: <b>${t.status}</b></p>`).style("left",`${e.clientX+10}px`).style("top",`${e.clientY+10}px`)})).on("mouseout",(()=>{this.tooltip.transition().duration(500).style("opacity",0)}))}),(e=>{e.attr("class",(e=>`${f(e.status)} ${y}`))}),(e=>{e.on("mouseover",null).on("mouseout",null).remove()}))}}createControls(){const e=document.createElement("button"),t=document.createElement("button"),i=document.createElement("button"),s="zoomControl";e.id="zoom_in",t.id="zoom_out",i.className="resetControl",e.className=s,t.className=s,this.el.append(e),this.el.append(t),this.el.append(i)}}function f(e){return e.toLowerCase().replace(/[ _]/g,"-")}t.DagVisualizeView=h},4658:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const s=i.p+"a3c0b34b33bc4dfa5c35fd5da5758f6349406ad811ea0ee93e05cbbf14ac998e.js"},4147:e=>{e.exports=JSON.parse('{"name":"@tiledb-inc/tiledb-plot-widget","version":"1.0.6","description":"Custom Jupyterlab widget for TileDB","keywords":["jupyter","jupyterlab","jupyterlab-extension"],"homepage":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget","bugs":{"url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget/issues"},"license":"MIT","author":{"name":"TileDB","email":"hello@tiledb.com"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","dist/*.js","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","icons/*.svg"],"main":"lib/index.js","types":"lib/index.d.ts","style":"style/index.css","repository":{"type":"git","url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget.git"},"scripts":{"build":"jlpm run build:lib && jlpm run build:labextension:dev","build:prod":"jlpm run clean && jlpm run build:lib && jlpm run build:labextension && jlpm run build:webpack","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:webpack":"webpack --mode=production","build:lib":"tsc","clean":"jlpm run clean:lib","clean:lib":"rimraf lib tsconfig.tsbuildinfo","clean:labextension":"rimraf tiledb/plot/widget/labextension","clean:all":"jlpm run clean:lib && jlpm run clean:labextension","eslint":"eslint . --ext .ts,.tsx --fix","eslint:check":"eslint . --ext .ts,.tsx","install:extension":"jlpm run build","watch":"run-p watch:src watch:labextension","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^4.0.0","@jupyterlab/application":"^3.1.0","d3":"^7.4.4"},"devDependencies":{"@jupyterlab/builder":"^3.1.0","@types/d3":"^7.1.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^4.8.1","@typescript-eslint/parser":"^4.8.1","eslint":"^7.14.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prettier":"^3.1.4","git-tag-version":"^1.3.1","npm-run-all":"^4.1.5","prettier":"^2.1.1","rimraf":"^3.0.2","source-map-loader":"^3.0.0","style-loader":"^3.3.1","ts-loader":"9","typescript":"~4.1.3","webpack":"^5.64.4","webpack-cli":"^4.9.1"},"sideEffects":["style/*.css","style/index.js"],"styleModule":"style/index.js","publishConfig":{"access":"public"},"jupyterlab":{"extension":true,"outputDir":"tiledb/plot/widget/labextension","discovery":{"server":{"managers":["pip"],"base":{"name":"tiledb-plot-widget"}}}},"jupyter-releaser":{"hooks":{"before-build-npm":["python -m pip install jupyterlab~=3.1","jlpm"]}}}')}}]);