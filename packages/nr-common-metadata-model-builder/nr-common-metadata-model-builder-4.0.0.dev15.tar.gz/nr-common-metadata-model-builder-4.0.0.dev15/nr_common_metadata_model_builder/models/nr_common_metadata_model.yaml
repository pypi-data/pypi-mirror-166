# Copyright (c) 2022 CESNET
#
# This software is released under the MIT License.
# https://opensource.org/licenses/MIT

oarepo:use: [invenio]

$defs:
  NRAuthorityIdentifier:
    oarepo:ui:
      default:
        component: icon
        dataField: scheme
        iconSet:
          DOI: icons/identifier/doi.gif
          scopusID: icons/identifier/scopus.svg
          orcid: icons/identifier/orcid.png
    properties:
      identifier:
        type: keyword
        required: true
        oarepo:sample:
          faker: isbn13
      scheme:
        type: keyword
        required: true
        enum:
          [
            orcid,
            scopusID,
            researcherID,
            czenasAutID,
            vedidk,
            institutionalID,
            ISNI,
            ROR,
            ICO,
            DOI,
          ]

  NRAuthority:
    properties:
      fullName:
        # TODO: moznost duplicity - pridat pole jmeno a prijmeni pro nove zaznamy + do ui generovani fullName podle pravidel
        type: keyword
        required: true
        oarepo:sample:
          faker: name
        oarepo:ui:
          component: span
      nameType:
        type: keyword
        enum: [Organizational, Personal]
        oarepo:sample: [Organizational, Personal]
      authorityIdentifiers[]:
        oarepo:use: '#/$defs/NRAuthorityIdentifier'
        uniqueItems[]: true
        oarepo:ui[]:
          default:
            component: list
            horizontal: true
            separator:
              component: separator
            item:
              # TODO: this reference should be automagically done by model builder
              oarepo:use: '#/$defs/NRAuthorityIdentifier/oarepo:ui/default'
      affiliations[]:
        # taxonomie institutions
        oarepo:sample:
          faker: company
        oarepo:vocabulary:
          type: affiliation
          fields: [id, title]
        uniqueItems[]: true

  NRObjectPID:
    # Persistent identifier of object

    properties:
      identifier:
        type: keyword
        required: true
        oarepo:sample:
          faker: isbn13
        oarepo:ui:
          default:
            component: span
      scheme:
        type: keyword
        required: true
        oarepo:ui:
          default:
            component: icon
            dataField: scheme
            iconSet:
              DOI: icons/identifier/doi.gif
        enum: [DOI, Handle, ISBN, ISSN, RIV]

  NRDateOrRange:
    type: keyword
    # TODO: jak validovat a interpretovat tento format (a jak ho pak spravne facetovat)
    format: 'year | yearmonth | date | datetime | year-range | yearmonth-range | date-range | datetime-range'
    oarepo:ui:
      default:
        component: span

  NRDate:
    type: keyword
    oarepo:ui:
      default:
        component: span
    # format: [ year | yearmonth | date | datetime ]

  NRLocation:
    properties:
      place:
        type: keyword
        required: true
      country:
        oarepo:use: '#/$defs/NRCountry'

  NRCountry:
    oarepo:vocabulary:
      type: country
      fields: [id, title]

  NRLongitude:
    type: number
    minimum: -180
    maximum: 180

  NRLatitude:
    type: number
    minimum: -90
    maximum: 90

  NRAuthorityRole:
    oarepo:ui:
      default:
        component: span
    oarepo:vocabulary:
      type: role
      fields: [id, title]

  NRRelatedItem:
    description: linkdata, propojení přidružených dokumentů a datasetů.

    properties:
      itemTitle:
        description: název propojeného dokumentu
        type: fulltext
        required: true
        oarepo:ui:
          default:
            component: span

      itemCreators[]:
        oarepo:use: '#/$defs/NRAuthority'
        uniqueItems[]: true
        properties:
          affiliations[]:
            oarepo:vocabulary:
              name: item-creator-affiliations

      itemContributors[]:
        oarepo:use: '#/$defs/NRAuthority'
        properties:
          role:
            oarepo:use: '#/$defs/NRAuthorityRole'
          affiliations[]:
            oarepo:vocabulary:
              name: item-creator-affiliations
        uniqueItems[]: true

      itemPIDs[]:
        oarepo:use: '#/$defs/NRObjectPID'
        uniqueItems[]: true

      itemURL:
        type: keyword
        format: URL
        oarepo:ui:
          default:
            component: link
        oarepo:sample:
          faker: url

      itemYear:
        type: integer
        oarepo:ui:
          default:
            component: span

      itemVolume:
        type: keyword
        oarepo:ui:
          default:
            component: span

      itemIssue:
        type: keyword
        oarepo:ui:
          default:
            component: span

      itemStartPage:
        type: keyword
        oarepo:ui:
          default:
            component: span

      itemEndPage:
        type: keyword
        oarepo:ui:
          default:
            component: span

      itemPublisher:
        type: keyword
        oarepo:ui:
          default:
            component: span

      itemRelationType:
        description: typ vztahu k původnímu popisovanému dok.
        oarepo:vocabulary:
          type: itemRelationType
          fields: [id, title]

      itemResourceType:
        oarepo:use: '#/$defs/NRResourceType'

  NRResourceType:
    oarepo:vocabulary:
      type: resourceType
      fields: [id, title]
    oarepo:sample: ['Bakalářská práce', 'Diplomová práce', 'Dataset']

  NRFundingReference:
    # informace o přidruženém projektu
    #
    # MIGRACE NUŠL - protože v datech NUŠL hrozný stav v polích pro poskytovatele.
    # u českých projektů na základě prvních dvou znaků v řetězci s identifikátorem
    # projektu lze přiřadit poskytovatele.
    oarepo:ui:
      default:
        component: divided-row
        separator:
          component: separator
        items:
          - component: span
            dataField: projectID
          - component: span
            dataField: projectName
    properties:
      projectID:
        type: keyword
        required: true
      projectName:
        type: fulltext
      fundingProgram:
        type: fulltext
      funder:
        oarepo:use: '#/$defs/NRFunder'
        #required: true

  NRSubject:
    properties:
      subjectScheme:
        type: keyword
        oarepo:sample: ['keyword', 'czenas', 'psh']
      subject:
        type: i18nStr
        required: true
      valueURI:
        type: keyword
        oarepo:sample:
          faker: url
      classificationCode:
        type: keyword

  NRSubjectCategory:
    oarepo:vocabulary:
      type: subjectCategories
      fields: [id, title]
    oarepo:sample:
      ['Pravděpodobnost a statistika', 'Matematika', 'Chemické vědy']

  NRFunder:
    oarepo:vocabulary:
      type: funders
      fields: [id, title]

  NRGeoLocation:
    properties:
      geoLocationPlace:
        description: Free description of the location; ie. Atlantic Ocean
        type: keyword
        required: true
      geoLocationPoint:
        properties:
          pointLongitude:
            oarepo:use: '#/$defs/NRLongitude'
            required: true
          pointLatitude:
            oarepo:use: '#/$defs/NRLatitude'
            required: true

  NRSystemIdentifier:
    # systémové identifikátory a trvalé adresy pořízené skrze OAI, případně importy/migrace",
    #
    # možná bude sekce OAI fungovat jinak,takže možná bude potřeba to upravit. Ale tohle jsou údaje,
    # které by se měli ukládat přímo v záznamu; nusl = PURL
    properties:
      identifier:
        type: keyword
        required: true
      scheme:
        type: keyword
        enum: [nusl, nuslOAI, originalRecordOAI, catalogueSysNo, nrOAI]
        required: true

  NREvent:
    properties:
      eventNameOriginal:
        # volný zápis celého názvu akce
        type: fulltext
        required: true

      eventNameAlternate[]:
        # zkrácená forma názvu akce nebo překladu. měla by fungovat jako alias pro vyhledávání
        type: fulltext

      eventDate:
        # rozsah konání akce/konference -  date or range.
        oarepo:use: '#/$defs/NRDateOrRange'
        required: true

      eventLocation:
        oarepo:use: '#/$defs/NRLocation'
        required: true

  NRLanguage:
    oarepo:vocabulary:
      type: languages
      fields: [id, title]
    oarepo:sample: ['cs', 'en', 'de', 'fr', 'it']

  NRLicense:
    oarepo:vocabulary:
      type: licenses
      fields: [id, title]
    oarepo:sample:
      - 'CC BY'
      - 'CC BY-SA'
      - 'CC BY-NC'
      - 'CC BY-ND'
      - 'CC BY-NC-SA'
      - 'CC BY-NC-ND'

  NRAccessRights:
    oarepo:vocabulary:
      type: accessRights
      fields: [id, title]
    oarepo:sample: [open, embargoed, restricted, 'metadata only']

model:
  oarepo:marshmallow:
    generate: false
    class: nr_common_metadata.services.schema.NRCommonMetadataSchema
  properties:
    metadata:
      properties:
        # TODO: nevyclenit mainTitle ven?
        title:
          type: i18nStr # Main (original) title of the object/work.
          required: true

        additionalTitles[]:
          # Additional titles of the object/work such as subtitle, translatedTitle and alternativeTitle.
          uniqueItems[]: true
          properties:
            # TODO: zvazit, jestli preci jenom neprejit na pole extenzi langstringu, abychom byli datacite (a rdm)
            # primo kompatibilni
            title:
              type: i18nStr
              required: true
            titleType:
              type: keyword
              required: true
              enum: [translatedTitle, alternativeTitle, subtitle, other]

        creators[]:
          oarepo:use: '#/$defs/NRAuthority'
          minItems[]: 1
          uniqueItems[]: true
          required[]: true
          properties:
            affiliations[]:
              oarepo:vocabulary:
                name: creator_affiliations

        contributors[]:
          oarepo:use: '#/$defs/NRAuthority'
          uniqueItems[]: true
          properties:
            role:
              oarepo:use: '#/$defs/NRAuthorityRole'
          properties:
            affiliations[]:
              oarepo:vocabulary:
                name: contributor_affiliations

        resourceType:
          # Taxonomy driven typology of objects that's possible to store in the repository
          oarepo:use: '#/$defs/NRResourceType'
          required: true

        dateAvailable:
          # The date the resource is publicly available in a repository.
          #
          # týká se dokumentu, nikoliv metadat!!!
          # stejně jako pro data, budou se přes něj řídit přístupy - embargo
          oarepo:use: '#/$defs/NRDate'
          oarepo:sample:
            faker: date

        dateModified:
          # The date of the last update to the resource, not metadata
          #
          # týká se dokumentu/obsahu, nikoliv metadat!!!
          # neukazuje se ve vkládacím formuláři. jen při editaci záznamu!
          oarepo:use: '#/$defs/NRDate'
          oarepo:sample:
            faker: date

        subjects[]:
          # subject by vocabularies or free-form keywords created by author(s)
          oarepo:use: '#/$defs/NRSubject'
          uniqueItems[]: true

        publishers[]:
          # volný zápis vydavatele
          type: fulltext
          uniqueItems[]: true
          oarepo:sample:
            faker: company

        subjectCategories[]:
          # FRASCATI oborové třídění - může sloužit jako podklad pro oborové filtrování
          oarepo:use: '#/$defs/NRSubjectCategory'
          uniqueItems[]: true

        languages[]:
          # ISO 639-2 B in slug, ISO 639-2 T in alias, ISO 639-1 as Alpha2.
          oarepo:use: '#/$defs/NRLanguage'
          minItems[]: 1
          required: true
          uniqueItems[]: true

        notes[]:
          # Free-form note for any comment that couldn't be inserted in any other fields.
          type: fulltext
          uniqueItems[]: true

        abstract:
          # i18nStr abstract description for record (may contain HTML).
          type: i18nStr

        methods:
          # i18nStr methodology employed for the study or research.(may contain HTML)
          type: i18nStr

        technicalInfo:
          # i18nStr detailed information that may be associated with
          # design, implementation, operation, use, and/or maintenance of a process
          # or system.(may contain HTML)
          type: i18nStr

        rights[]:
          # Any license or copyright information for this resource. Taxonomy field.
          oarepo:use: '#/$defs/NRAccessRights'
          uniqueItems[]: true

        accessRights:
          # Taxonomy driven list of possible access to the document - open,
          # embargoed, restirected and metadata only access. Based on COAR
          # vocabulary - http://vocabularies.coar-repositories.org/documentation/access_rights/",
          oarepo:use: '#/$defs/NRAccessRights'

        relatedItems[]:
          oarepo:use: '#/$defs/NRRelatedItem'
          uniqueItems[]: true

        fundingReferences[]:
          oarepo:use: '#/$defs/NRFundingReference'
          uniqueItems[]: true

        version:
          # verze obsahu, nikoliv záznamu. hodnota ve formuláři není editovatelná.
          type: keyword
          oarepo:sample: ['1.0', '1.1', '2.0', '2.1', '2.2']

        geoLocations[]:
          oarepo:use: '#/$defs/NRGeoLocation'
          uniqueItems[]: true

        accessibility:
          # textové vyjádření dostupnosti souborů, primárně pro harvestované zdroje.
          # nastavuje se pro každý zdroj zvlášť během konverze podle dostupnosti souborů
          # ve zdrojovém systému. ve vkládacím formuláři by bylo pouze pro restricted access
          type: i18nStr

        series[]:
          # edice; tématicky sdružuje podobné věci, nemusí se jednat o pravou edici,
          # ale tagování/grupování podobných záznamů
          uniqueItems[]: true

          properties:
            seriesTitle:
              type: keyword
              required: true
              # našeptávač již uložených hodnot
              oarepo:sample: ['series A', 'series B', 'series C']
            seriesVolume:
              type: keyword
              oarepo:sample: ['1', '2', '3', '4']

        externalLocation:
          # externí umístění dokumentu (mimo repozitáře), formát URL
          properties:
            externalLocationURL:
              type: keyword
              format: URL
              required: true
              oarepo:sample:
                faker: url

            externalLocationNote:
              type: fulltext

        originalRecord:
          # odkaz na původní záznam, zobrazovat koncovému uživateli v detailu záznamu
          # jako původní místo uložení. objevuje se jen u harvestu
          type: keyword
          format: URL
          oarepo:sample:
            faker: url

        objectIdentifiers[]:
          # Persistent identifier/s of object as ISBN, DOI, etc. + assigned by National Repository.
          oarepo:use: '#/$defs/NRObjectPID'
          uniqueItems[]: true

        systemIdentifiers[]:
          oarepo:use: '#/$defs/NRSystemIdentifier'

        events[]:
          oarepo:use: '#/$defs/NREvent'
